2025-03-29 23:06:58,550 ERROR: 详细信息: {"endpoint": "dashboard_api.get_dashboard_metrics", "method": "POST", "url": "http://127.0.0.1:5101/api/dashboard/metrics", "user_agent": "Unknown", "traceback": "Traceback (most recent call last):\n  File \"/Volumes/文件资料/medicalman/app/routes/dashboard_routes.py\", line 476, in get_dashboard_metrics\n    formatted_stats = format_stats(metrics)\n                      ^^^^^^^^^^^^\nNameError: name 'format_stats' is not defined\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Volumes/文件资料/medicalman/app/utils/error_handler.py\", line 154, in wrapper\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Volumes/文件资料/medicalman/app/routes/dashboard_routes.py\", line 501, in get_dashboard_metrics\n    \"data\": generate_fallback_dashboard_data()\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nNameError: name 'generate_fallback_dashboard_data' is not defined. Did you mean: 'format_fallback_dashboard_data'?\n"} [in /Volumes/文件资料/medicalman/app/utils/error_handler.py:202]
2025-03-29 23:07:02,164 INFO: 请求科室工作量数据 - 开始: 2024-03-29, 结束: 2025-03-29, 科室: [] [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:534]
2025-03-29 23:07:02,165 INFO: 执行SQL查询: 
        SELECT date, department, outpatient_count, inpatient_count, 
               surgery_count, emergency_count, consultation_count, total_count
        FROM department_workload
        WHERE date BETWEEN ? AND ?
         ORDER BY date, department 参数: ['2024-03-29', '2025-03-29'] [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:554]
2025-03-29 23:07:02,196 INFO: 科室工作量数据查询成功，返回 5490 条记录 [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:576]
2025-03-29 23:07:02,272 INFO: 请求科室工作量数据 - 开始: 2024-03-29, 结束: 2025-03-29, 科室: [] [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:534]
2025-03-29 23:07:02,291 INFO: 执行SQL查询: 
        SELECT date, department, outpatient_count, inpatient_count, 
               surgery_count, emergency_count, consultation_count, total_count
        FROM department_workload
        WHERE date BETWEEN ? AND ?
         ORDER BY date, department 参数: ['2024-03-29', '2025-03-29'] [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:554]
2025-03-29 23:07:02,343 INFO: 科室工作量数据查询成功，返回 5490 条记录 [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:576]
2025-03-29 23:07:09,599 INFO: 请求科室工作量数据 - 开始: 2024-03-29, 结束: 2025-03-29, 科室: [] [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:534]
2025-03-29 23:07:09,602 INFO: 执行SQL查询: 
        SELECT date, department, outpatient_count, inpatient_count, 
               surgery_count, emergency_count, consultation_count, total_count
        FROM department_workload
        WHERE date BETWEEN ? AND ?
         ORDER BY date, department 参数: ['2024-03-29', '2025-03-29'] [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:554]
2025-03-29 23:07:09,628 INFO: 科室工作量数据查询成功，返回 5490 条记录 [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:576]
2025-03-29 23:07:09,693 INFO: 请求科室工作量数据 - 开始: 2024-03-29, 结束: 2025-03-29, 科室: [] [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:534]
2025-03-29 23:07:09,722 INFO: 执行SQL查询: 
        SELECT date, department, outpatient_count, inpatient_count, 
               surgery_count, emergency_count, consultation_count, total_count
        FROM department_workload
        WHERE date BETWEEN ? AND ?
         ORDER BY date, department 参数: ['2024-03-29', '2025-03-29'] [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:554]
2025-03-29 23:07:09,792 INFO: 科室工作量数据查询成功，返回 5490 条记录 [in /Volumes/文件资料/medicalman/app/routes/analytics_routes.py:576]
2025-03-29 23:07:20,965 ERROR: 获取仪表盘数据出错: name 'format_stats' is not defined [in /Volumes/文件资料/medicalman/app/routes/dashboard_routes.py:494]
2025-03-29 23:07:20,985 ERROR: API请求处理出错: name 'generate_fallback_dashboard_data' is not defined [in /Volumes/文件资料/medicalman/app/utils/error_handler.py:201]
2025-03-29 23:07:20,986 ERROR: 详细信息: {"endpoint": "dashboard_api.get_dashboard_metrics", "method": "POST", "url": "http://127.0.0.1:5101/api/dashboard/metrics", "user_agent": "Unknown", "traceback": "Traceback (most recent call last):\n  File \"/Volumes/文件资料/medicalman/app/routes/dashboard_routes.py\", line 476, in get_dashboard_metrics\n    formatted_stats = format_stats(metrics)\n                      ^^^^^^^^^^^^\nNameError: name 'format_stats' is not defined\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Volumes/文件资料/medicalman/app/utils/error_handler.py\", line 154, in wrapper\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Volumes/文件资料/medicalman/app/routes/dashboard_routes.py\", line 501, in get_dashboard_metrics\n    \"data\": generate_fallback_dashboard_data()\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nNameError: name 'generate_fallback_dashboard_data' is not defined. Did you mean: 'format_fallback_dashboard_data'?\n"} [in /Volumes/文件资料/medicalman/app/utils/error_handler.py:202]
2025-03-29 23:08:24,038 INFO: 医疗工作量系统启动 [in /Volumes/文件资料/medicalman/app/__init__.py:196]
2025-03-29 23:08:24,039 INFO: 开始初始化数据库... [in /Volumes/文件资料/medicalman/app/__init__.py:111]
2025-03-29 23:08:24,039 INFO: 数据库URI: sqlite:////Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:114]
2025-03-29 23:08:24,039 INFO: 数据库路径: /Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:116]
2025-03-29 23:08:24,039 INFO: 数据库路径是否存在: True [in /Volumes/文件资料/medicalman/app/__init__.py:117]
2025-03-29 23:08:24,041 INFO: 数据库初始化完成 [in /Volumes/文件资料/medicalman/app/__init__.py:120]
2025-03-29 23:08:24,050 INFO: 演示数据初始化完成 [in /Volumes/文件资料/medicalman/app/__init__.py:126]
2025-03-29 23:08:33,124 INFO: 医疗工作量系统启动 [in /Volumes/文件资料/medicalman/app/__init__.py:196]
2025-03-29 23:08:33,125 INFO: 开始初始化数据库... [in /Volumes/文件资料/medicalman/app/__init__.py:111]
2025-03-29 23:08:33,125 INFO: 数据库URI: sqlite:////Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:114]
2025-03-29 23:08:33,125 INFO: 数据库路径: /Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:116]
2025-03-29 23:08:33,125 INFO: 数据库路径是否存在: True [in /Volumes/文件资料/medicalman/app/__init__.py:117]
2025-03-29 23:08:33,127 INFO: 数据库初始化完成 [in /Volumes/文件资料/medicalman/app/__init__.py:120]
2025-03-29 23:08:33,135 INFO: 演示数据初始化完成 [in /Volumes/文件资料/medicalman/app/__init__.py:126]
2025-03-29 23:09:03,057 INFO: 医疗工作量系统启动 [in /Volumes/文件资料/medicalman/app/__init__.py:196]
2025-03-29 23:09:03,057 INFO: 开始初始化数据库... [in /Volumes/文件资料/medicalman/app/__init__.py:111]
2025-03-29 23:09:03,057 INFO: 数据库URI: sqlite:////Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:114]
2025-03-29 23:09:03,058 INFO: 数据库路径: /Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:116]
2025-03-29 23:09:03,058 INFO: 数据库路径是否存在: True [in /Volumes/文件资料/medicalman/app/__init__.py:117]
2025-03-29 23:09:03,059 INFO: 数据库初始化完成 [in /Volumes/文件资料/medicalman/app/__init__.py:120]
2025-03-29 23:09:03,068 INFO: 演示数据初始化完成 [in /Volumes/文件资料/medicalman/app/__init__.py:126]
2025-03-29 23:11:01,811 INFO: 医疗工作量系统启动 [in /Volumes/文件资料/medicalman/app/__init__.py:196]
2025-03-29 23:11:01,811 INFO: 开始初始化数据库... [in /Volumes/文件资料/medicalman/app/__init__.py:111]
2025-03-29 23:11:01,811 INFO: 数据库URI: sqlite:////Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:114]
2025-03-29 23:11:01,811 INFO: 数据库路径: /Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:116]
2025-03-29 23:11:01,812 INFO: 数据库路径是否存在: True [in /Volumes/文件资料/medicalman/app/__init__.py:117]
2025-03-29 23:11:01,813 INFO: 数据库初始化完成 [in /Volumes/文件资料/medicalman/app/__init__.py:120]
2025-03-29 23:11:01,823 INFO: 演示数据初始化完成 [in /Volumes/文件资料/medicalman/app/__init__.py:126]
2025-03-29 23:11:11,616 INFO: 医疗工作量系统启动 [in /Volumes/文件资料/medicalman/app/__init__.py:196]
2025-03-29 23:11:11,616 INFO: 开始初始化数据库... [in /Volumes/文件资料/medicalman/app/__init__.py:111]
2025-03-29 23:11:11,616 INFO: 数据库URI: sqlite:////Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:114]
2025-03-29 23:11:11,616 INFO: 数据库路径: /Volumes/文件资料/medicalman/instance/medical_workload.db [in /Volumes/文件资料/medicalman/app/__init__.py:116]
2025-03-29 23:11:11,617 INFO: 数据库路径是否存在: True [in /Volumes/文件资料/medicalman/app/__init__.py:117]
2025-03-29 23:11:11,618 INFO: 数据库初始化完成 [in /Volumes/文件资料/medicalman/app/__init__.py:120]
